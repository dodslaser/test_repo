# Run jobs on pull request events
---
  name: Pull Request Workflow
  permissions: read-all

  on:
    pull_request_target:
      branches:
      - dev
      - main
      - release-pr
      types: [opened, closed]

  jobs:
    close-non-release-pr:
      if: |
        github.ref_name == 'main' &&
        github.event.action == 'opened'
      name: Close non-release PRs
      uses: ./.github/workflows/def_close-non-release-pr.yml
      with:
        pull_request_number: ${{ github.event.pull_request.number }}
      permissions:
        pull-requests: write

    publish-release:
      if: |
        github.ref_name == 'main' &&
        github.head_ref == 'release-pr' &&
        github.event.action == 'closed' &&
        github.event.pull_request.merged == true
      name: Publish release
      uses: ./.github/workflows/def_publish-release.yml
      permissions:
        pull-requests: write
        contents: write
      with:
        body: ${{ github.event.pull_request.body }}
